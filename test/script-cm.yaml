apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-app-status-script
  namespace: <your-namespace>  # Replace with your namespace
data:
  get-argocd-app-status.sh: |
    #!/bin/bash

    # Label to filter applications
    LABEL_SELECTOR="your-label-key=your-label-value"

    # Get the list of Argo CD applications with the specific label using kubectl
    applications=$(kubectl get applications.argoproj.io -l $LABEL_SELECTOR -o jsonpath='{.items[*].metadata.name}')

    if [ -z "$applications" ]; then
      echo "No applications found with label: $LABEL_SELECTOR"
      exit 1
    fi

    # Loop through each application and get the health and sync status
    echo "Application Name | Health Status | Sync Status"
    echo "------------------------------------------------"

    for app in $applications; do
      # Fetch health and sync status using kubectl
      health_status=$(kubectl get application.argoproj.io "$app" -o jsonpath='{.status.health.status}')
      sync_status=$(kubectl get application.argoproj.io "$app" -o jsonpath='{.status.sync.status}')
      
      # Display the results
      echo "$app | $health_status | $sync_status"
    done
